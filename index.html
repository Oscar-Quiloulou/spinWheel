<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Roue al√©atoire de pr√©noms</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* -------------------- THEME -------------------- */
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #e2e8f0;
  --muted: #94a3b8;
  --accent: #3b82f6;
  --winner-bg: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
  display: flex;
  justify-content: center;
  padding: 20px;
}

/* -------------------- LAYOUT -------------------- */
.app {
  width: 100%;
  max-width: 1100px;
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 20px;
}

@media (max-width: 900px) {
  .app { grid-template-columns: 1fr; }
}

.card {
  background: var(--card);
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 0 20px #0005;
}

/* -------------------- WHEEL -------------------- */
.wheel-container {
  position: relative;
  display: flex;
  justify-content: center;
}

canvas {
  max-width: 100%;
}

.pointer {
  position: absolute;
  top: 50%;
  right: 50%;
  transform: translate(50%, -50%);
  width: 0;
  height: 0;
  border-top: 14px solid transparent;
  border-bottom: 14px solid transparent;
  border-left: 22px solid #fbbf24;
}

/* -------------------- BUTTON -------------------- */
.spin-btn {
  margin-top: 10px;
  padding: 12px 24px;
  border-radius: 999px;
  border: none;
  background: #22c55e;
  color: white;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 10px 25px #22c55e55;
  transition: 0.15s;
}

.spin-btn:active {
  transform: scale(0.95);
}

/* -------------------- RESULT -------------------- */
.result-box {
  margin-top: 20px;
  text-align: center;
  padding: 20px;
  border-radius: 14px;
  background: var(--winner-bg);
  color: #111;
  font-size: 1.6rem;
  font-weight: 800;
  box-shadow: 0 0 25px #fbbf2466;
  transform: scale(0.6);
  opacity: 0;
  transition: 0.35s cubic-bezier(.25,1.4,.3,1), opacity 0.3s ease;
}

.result-box.show {
  transform: scale(1);
  opacity: 1;
}

/* -------------------- CONFETTIS -------------------- */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: red;
  top: -10px;
  animation: fall 2.4s linear forwards;
  opacity: 0.9;
}

@keyframes fall {
  to {
    transform: translateY(120vh) rotate(720deg);
    opacity: 0;
  }
}

/* -------------------- LISTE -------------------- */
input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #0f172a;
  color: var(--text);
}

.btn {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.btn-primary { background: var(--accent); color: white; }
.btn-danger { background: #ef4444; color: white; }
.btn-secondary { background: #334155; color: white; }

.name-item {
  background: #0f172a;
  padding: 8px 10px;
  border-radius: 10px;
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
}
</style>
</head>

<body>
<div class="app">

<!-- -------------------- WHEEL CARD -------------------- -->
<div class="card">
  <h2>üé° Roue al√©atoire</h2>

  <div class="wheel-container">
    <canvas id="wheel" width="420" height="420"></canvas>
    <div class="pointer"></div>
  </div>

  <button id="spinBtn" class="spin-btn">Lancer la roue</button>

  <div id="result" class="result-box"></div>
</div>

<!-- -------------------- CONTROL PANEL -------------------- -->
<div class="card">
  <h2>Liste des pr√©noms</h2>

  <input id="nameInput" placeholder="Ajouter un pr√©nom">
  <button id="addBtn" class="btn btn-primary" style="margin-top:10px;">Ajouter</button>

  <div style="margin-top:10px;">
    <button id="shuffleBtn" class="btn btn-secondary">M√©langer</button>
    <button id="clearBtn" class="btn btn-danger">Tout effacer</button>
  </div>

  <div id="nameList" style="margin-top:15px;"></div>
</div>

</div>

<!-- -------------------- JS -------------------- -->
<script>
/* -------------------- STORAGE -------------------- */
const STORAGE_KEY = "roulette_prenoms_v2";
let names = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(names));
}

/* -------------------- DOM -------------------- */
const nameInput = document.getElementById("nameInput");
const addBtn = document.getElementById("addBtn");
const shuffleBtn = document.getElementById("shuffleBtn");
const clearBtn = document.getElementById("clearBtn");
const nameList = document.getElementById("nameList");
const resultEl = document.getElementById("result");
const spinBtn = document.getElementById("spinBtn");

/* -------------------- LISTE -------------------- */
function renderList() {
  nameList.innerHTML = "";
  names.forEach((n, i) => {
    const div = document.createElement("div");
    div.className = "name-item";
    div.innerHTML = `
      <span>${n}</span>
      <button class="btn btn-danger" style="padding:4px 8px;">X</button>
    `;
    div.querySelector("button").onclick = () => {
      names.splice(i, 1);
      save();
      renderList();
      drawWheel();
    };
    nameList.appendChild(div);
  });
}

addBtn.onclick = () => {
  const raw = nameInput.value.trim();
  if (!raw) return;
  raw.split(/[,;\n]/).map(s => s.trim()).filter(Boolean).forEach(n => {
    if (!names.includes(n)) names.push(n);
  });
  nameInput.value = "";
  save();
  renderList();
  drawWheel();
};

shuffleBtn.onclick = () => {
  for (let i = names.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [names[i], names[j]] = [names[j], names[i]];
  }
  save();
  renderList();
  drawWheel();
};

clearBtn.onclick = () => {
  if (confirm("Tout effacer ?")) {
    names = [];
    save();
    renderList();
    drawWheel();
  }
};

/* -------------------- WHEEL -------------------- */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const radius = size / 2;
let currentAngle = 0;
let spinning = false;

function randomColor(i) {
  const colors = ["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#a855f7","#ec4899"];
  return colors[i % colors.length];
}

function drawWheel() {
  ctx.clearRect(0, 0, size, size);

  if (names.length === 0) {
    ctx.fillStyle = "#475569";
    ctx.font = "bold 18px system-ui";
    ctx.textAlign = "center";
    ctx.fillText("Ajoute des pr√©noms", radius, radius);
    return;
  }

  const slice = (Math.PI * 2) / names.length;

  ctx.save();
  ctx.translate(radius, radius);
  ctx.rotate(currentAngle);

  for (let i = 0; i < names.length; i++) {
    const start = i * slice;
    const end = start + slice;

    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, radius - 10, start, end);
    ctx.fillStyle = randomColor(i);
    ctx.fill();

    ctx.save();
    ctx.rotate(start + slice / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "white";
    ctx.font = "bold 16px system-ui";
    ctx.fillText(names[i], radius - 20, 0);
    ctx.restore();
  }

  ctx.restore();
}

function getWinner(angle) {
  const slice = (Math.PI * 2) / names.length;
  const normalized = (Math.PI * 2 - (angle % (Math.PI * 2))) % (Math.PI * 2);
  return names[Math.floor(normalized / slice)];
}

/* -------------------- CONFETTIS -------------------- */
function spawnConfetti() {
  for (let i = 0; i < 80; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random() * 100 + "vw";
    c.style.background = randomColor(i);
    c.style.animationDuration = 1.8 + Math.random() * 1.2 + "s";
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 2500);
  }
}

/* -------------------- SPIN -------------------- */
spinBtn.onclick = () => {
  if (spinning || names.length === 0) return;
  spinning = true;
  spinBtn.disabled = true;
  resultEl.classList.remove("show");

  const extra = 4 + Math.random() * 3;
  const finalAngle = currentAngle + extra * Math.PI * 2 + Math.random() * Math.PI * 2;
  const duration = 2600 + Math.random() * 800;
  const start = performance.now();
  const startAngle = currentAngle;

  function animate(now) {
    const t = Math.min(1, (now - start) / duration);
    const eased = 1 - Math.pow(1 - t, 3);
    currentAngle = startAngle + (finalAngle - startAngle) * eased;
    drawWheel();

    if (t < 1) requestAnimationFrame(animate);
    else {
      spinning = false;
      spinBtn.disabled = false;

      const winner = getWinner(currentAngle);
      resultEl.innerHTML = winner;
      resultEl.classList.add("show");

      spawnConfetti();
    }
  }

  requestAnimationFrame(animate);
};

/* -------------------- INIT -------------------- */
renderList();
drawWheel();
</script>

</body>
</html>
